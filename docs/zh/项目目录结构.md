# KrillinAI 项目目录结构

## 项目概述

KrillinAI 是一个基于 Go 语言开发的 AI 视频翻译和配音工具，支持桌面版和服务器版两种运行模式。

## 目录结构说明

```
KrillinAI/
├── .github/                    # GitHub 配置文件
│   ├── ISSUE_TEMPLATE/        # Issue 模板
│   └── workflows/             # GitHub Actions 工作流
│
├── cmd/                        # 应用程序入口
│   ├── desktop/               # 桌面版入口
│   │   └── main.go           # 桌面版主程序
│   └── server/                # 服务器版入口
│       └── main.go           # 服务器版主程序
│
├── config/                     # 配置文件目录
│   ├── config-example.toml    # 配置文件示例
│   └── config.go             # 配置文件解析逻辑
│
├── docs/                       # 文档目录
│   ├── ar/                    # 阿拉伯语文档
│   ├── de/                    # 德语文档
│   ├── es/                    # 西班牙语文档
│   ├── fr/                    # 法语文档
│   ├── images/                # 文档图片资源
│   ├── jp/                    # 日语文档
│   ├── kr/                    # 韩语文档
│   ├── pt/                    # 葡萄牙语文档
│   ├── rus/                   # 俄语文档
│   ├── vi/                    # 越南语文档
│   └── zh/                    # 中文文档
│       ├── README.md         # 中文主文档
│       ├── aliyun.md         # 阿里云配置说明
│       ├── docker.md         # Docker 部署说明
│       ├── faq.md            # 常见问题
│       └── 项目目录结构.md    # 本文档
│
├── internal/                   # 内部包（不对外暴露）
│   ├── api/                   # API 接口定义
│   │   └── subtitle.go       # 字幕相关 API
│   │
│   ├── deps/                  # 依赖检查
│   │   └── checker.go        # 依赖检查器
│   │
│   ├── desktop/               # 桌面版 UI 组件
│   │   ├── components.go     # UI 组件
│   │   ├── desktop.go        # 桌面应用主逻辑
│   │   ├── file.go           # 文件操作
│   │   ├── subtitle.go       # 字幕处理
│   │   ├── theme.go          # 主题定义
│   │   ├── theme_manager.go  # 主题管理器
│   │   └── ui.go             # UI 界面
│   │
│   ├── dto/                   # 数据传输对象
│   │   └── subtitle_task.go  # 字幕任务 DTO
│   │
│   ├── handler/               # HTTP 请求处理器
│   │   ├── config.go         # 配置处理器
│   │   ├── init.go           # 初始化
│   │   ├── middleware.go     # 中间件
│   │   └── subtitle_task.go  # 字幕任务处理器
│   │
│   ├── response/              # 响应封装
│   │   └── response.go       # 统一响应格式
│   │
│   ├── router/                # 路由配置
│   │   └── router.go         # 路由定义
│   │
│   ├── server/                # 服务器配置
│   │   └── server.go         # HTTP 服务器
│   │
│   ├── service/               # 业务逻辑层
│   │   ├── audio2subtitle.go      # 音频转字幕
│   │   ├── audio2subtitle_test.go # 音频转字幕测试
│   │   ├── get_video_info.go      # 获取视频信息
│   │   ├── init.go                # 服务初始化
│   │   ├── link2file.go           # 链接转文件
│   │   ├── split_audio.go         # 音频分割
│   │   ├── srt2speech.go          # 字幕转语音
│   │   ├── srt_embed.go           # 字幕嵌入
│   │   ├── subtitle_service.go    # 字幕服务
│   │   ├── timestamps.go          # 时间戳处理
│   │   └── upload_subtitle.go     # 字幕上传
│   │
│   ├── storage/               # 数据存储层
│   │   ├── bin.go            # 二进制文件存储
│   │   └── subtitle_task.go  # 字幕任务存储
│   │
│   └── types/                 # 类型定义
│       ├── embed_subtitle.go # 嵌入字幕类型
│       ├── fasterwhisper.go  # FasterWhisper 类型
│       ├── interface.go      # 接口定义
│       ├── language.go       # 语言类型
│       ├── subtitle_task.go  # 字幕任务类型
│       ├── whispercpp.go     # WhisperCpp 类型
│       ├── whisperkit.go     # WhisperKit 类型
│       └── whisperx.go       # WhisperX 类型
│
├── log/                        # 日志配置
│   └── zap.go                 # Zap 日志配置
│
├── pkg/                        # 公共包（可对外暴露）
│   ├── aliyun/                # 阿里云服务集成
│   │   ├── asr.go            # 语音识别
│   │   ├── base.go           # 基础配置
│   │   ├── chat.go           # 对话服务
│   │   ├── oss.go            # 对象存储
│   │   ├── tts.go            # 文字转语音
│   │   └── voice_clone.go    # 语音克隆
│   │
│   ├── fasterwhisper/         # FasterWhisper 集成
│   │   ├── init.go           # 初始化
│   │   └── transcription.go  # 转录功能
│   │
│   ├── localtts/              # 本地 TTS 服务
│   │   └── edgetts.go        # Edge TTS
│   │
│   ├── openai/                # OpenAI 服务集成
│   │   ├── init.go           # 初始化
│   │   └── openai.go         # OpenAI API
│   │
│   ├── util/                  # 工具函数
│   │   ├── audio.go          # 音频处理
│   │   ├── base.go           # 基础工具
│   │   ├── download.go       # 下载工具
│   │   ├── language.go       # 语言处理
│   │   ├── queue.go          # 队列工具
│   │   ├── subtitle.go       # 字幕工具
│   │   ├── subtitle_test.go  # 字幕工具测试
│   │   └── video.go          # 视频处理
│   │
│   ├── whisper/               # OpenAI Whisper 集成
│   │   ├── init.go           # 初始化
│   │   └── whisper.go        # Whisper API
│   │
│   ├── whispercpp/            # WhisperCpp 集成
│   │   ├── init.go           # 初始化
│   │   └── transcription.go  # 转录功能
│   │
│   ├── whisperkit/            # WhisperKit 集成（macOS）
│   │   ├── init.go           # 初始化
│   │   └── transcription.go  # 转录功能
│   │
│   └── whisperx/              # WhisperX 集成
│       ├── init.go           # 初始化
│       └── transcription.go  # 转录功能
│
├── static/                     # 静态资源
│   ├── source/                # 源文件
│   ├── background.jpg         # 背景图片
│   ├── embed.go              # 静态资源嵌入
│   └── index.html            # Web UI 主页
│
├── Dockerfile                  # Docker 镜像构建文件
├── LICENSE                     # 开源协议
├── README.md                   # 英文主文档
├── aliyun.md                   # 阿里云配置说明（英文）
├── docker.md                   # Docker 部署说明（英文）
├── edge_tts_voice_code.md      # Edge TTS 语音代码说明
├── faq.md                      # 常见问题（英文）
├── go.mod                      # Go 模块依赖
└── go.sum                      # Go 模块校验和
```

## 核心模块说明

### 1. cmd - 应用程序入口
- **desktop**: 桌面版应用，提供图形化界面
- **server**: 服务器版应用，提供 Web API 服务

### 2. internal - 内部实现
- **api**: API 接口定义
- **desktop**: 桌面版 UI 组件和逻辑
- **handler**: HTTP 请求处理
- **service**: 核心业务逻辑
- **storage**: 数据存储
- **types**: 类型定义

### 3. pkg - 公共包
- **aliyun**: 阿里云服务（ASR、TTS、OSS、语音克隆）
- **openai**: OpenAI 服务（Whisper、GPT）
- **fasterwhisper/whispercpp/whisperkit/whisperx**: 多种语音识别引擎
- **util**: 通用工具函数

### 4. 配置文件
- `config/config-example.toml`: 配置文件模板
- 包含应用配置、服务器配置、LLM 配置、语音识别配置、TTS 配置

### 5. 静态资源
- `static/`: Web UI 相关的静态文件
- 通过 Go embed 嵌入到二进制文件中

## 技术栈

- **语言**: Go
- **Web 框架**: 基于标准库的 HTTP 服务器
- **桌面 UI**: Fyne 框架
- **语音识别**: Whisper 系列（OpenAI、FasterWhisper、WhisperCpp、WhisperKit、WhisperX）
- **大语言模型**: 支持 OpenAI API 规范的所有模型
- **TTS**: 阿里云 TTS、OpenAI TTS、Edge TTS
- **日志**: Zap

## 开发指南

### 添加新功能
1. 在 `internal/service/` 中实现业务逻辑
2. 在 `internal/handler/` 中添加 HTTP 处理器
3. 在 `internal/router/` 中注册路由
4. 如需新的类型定义，添加到 `internal/types/`

### 集成新的服务
1. 在 `pkg/` 下创建新的包
2. 实现相应的接口（定义在 `internal/types/interface.go`）
3. 在配置文件中添加相应配置项
4. 在 `config/config.go` 中添加配置解析

### 添加新的语言支持
1. 在 `docs/` 下创建对应语言代码的目录
2. 翻译 README.md、aliyun.md、docker.md、faq.md
3. 在主 README.md 中添加语言链接

## 构建和部署

### 本地构建
```bash
# 构建服务器版
go build -o krillinai ./cmd/server

# 构建桌面版
go build -o krillinai-desktop ./cmd/desktop
```

### Docker 部署
参考 `docs/zh/docker.md` 文档

## 相关文档

- [中文主文档](./README.md)
- [阿里云配置说明](./aliyun.md)
- [Docker 部署说明](./docker.md)
- [常见问题](./faq.md)

